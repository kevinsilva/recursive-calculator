<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Recursive Calculator</title>
</head>

<body>
    <div class="calculator">
        <div class="case">
            <div class="case__header">
                <img src="./img/logo.png" alt="logo" class="logo" />
            </div>
            <div class="case__display">
                <div class="case__display-frame">
                    <div class="display">
                        <div class="display__secondary">
                            <p></p>
                        </div>
                        <div class="display__main">
                            <h1></h1>
                        </div>
                    </div>
                </div>
            </div>
            <div class="case__numpad">
                <div class="numpad">
                    <div class="numpad__main">
                        <button id="exit" class="key">S</button>
                        <button id="help" class="key">A</button>
                    </div>
                    <div class="numpad__extra">
                        <button id="clear-all" class="key">C</button>
                        <button id="open" class="key parens">(</button>
                        <button id="close" class="key parens">)</button>
                        <!-- <button id="close" class="key">)</button> -->
                        <!-- <button class="delete">DEL</button> -->
                    </div>
                    <div class="numpad__secondary">
                        <!-- class="key key--operator  -->
                        <button id="exp" class="key operator operator--unary">EXP </button>
                        <button id="log" class="key operator operator--unary">LOG </button>
                        <button id="sin" class="key operator operator--unary">SIN </button>
                        <button id="cos" class="key operator operator--unary">COS </button>
                        <button id="ceil" class="key operator operator--unary">CEIL </button>
                        <button id="divide" class="key operator operator--binary">/ </button>
                        <button id="seven" class="key operand">7</button>
                        <button id="eight" class="key operand">8</button>
                        <button id="nine" class="key operand">9</button>
                        <button id="floor" class="key operator operator--unary">FLOOR</button>
                        <!-- <div id="floor" class="key key--pill text-small">FLR</div> -->
                        <button id="multiply" class="key operator operator--binary"> * </button>
                        <button id="four" class="key operand">4</button>
                        <!-- <button class="five operand">5</button> -->
                        <button id="five" class="key operand">5</button>
                        <button id="six" class="key operand">6</button>
                        <button id="round" class="key operator operator--unary"> ROUND </button>
                        <button id="subtract" class="key operator operator--binary"> - </button>
                        <button id="one" class="key operand">1</button>
                        <button id="two" class="key operand">2</button>
                        <button id="three" class="key operand">3</button>
                        <button id="abs" class="key operator operator--unary"> ABS </button>
                        <button id="add" class="key operator operator--binary"> + </button>
                        <button id="zero" class="key operand">0</button>
                        <button id="dot" class="key">.</button>
                        <button id="equal" class="key">=</button>
                        <button id="space" class="key">SPACE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module" defer>
        import CommandsManager from "./commands-manager/CommandsManager.js";
        import singlePassEvaluator from "./calc-engine/single-pass/single-pass.js";
        import MemoryManager from "./memory-manager/MemoryManager.js";
        import InterfaceManager from "./interface-manager/InterfaceManager.js";
        import DisplayController from "./controllers/DisplayController.js";

        const memoryManager = new MemoryManager();
        const calcEngine = singlePassEvaluator;
        const calculator = new CommandsManager(memoryManager, calcEngine);

        const operandKeys = document.querySelectorAll(".operand");
        const operatorKeys = document.querySelectorAll(".operator");
        const parensKeys = document.querySelectorAll(".parens");
        const secondaryDisplay = document.querySelector(
            ".display__secondary"
        );
        const mainDisplay = document.querySelector(".display__main");
        const exitKey = document.getElementById("exit");
        const helpKey = document.getElementById("help");
        const clearAllKey = document.getElementById("clear-all");
        const openKey = document.getElementById("open");
        const closeKey = document.getElementById("close");
        const dotKey = document.getElementById("dot");
        const spaceKey = document.getElementById("space");
        const equalKey = document.getElementById("equal");

        const interfaceCalc = new InterfaceManager(
            calculator,
            mainDisplay,
            secondaryDisplay
        );

        const displayController = new DisplayController({
            elMain: mainDisplay,
            elSecondary: secondaryDisplay,
        });

        //TODO arranjar nome mais específico
        function handleKeyClicks(keys) {
            keys.forEach((key) => {
                key.addEventListener("click", () => {
                    interfaceCalc.add(key.innerText);
                    interfaceCalc.render();
                });
            });
        }

        handleKeyClicks(operandKeys);
        handleKeyClicks(operatorKeys);
        handleKeyClicks(parensKeys);

        clearAllKey.addEventListener("click", () => {
            displayController.clear();
            // interfaceCalc.clear();
            // interfaceCalc.render();
        });

        equalKey.addEventListener("click", () => {
            interfaceCalc.runCalculator(
                "CE " + interfaceCalc.currentCalculation
            );
            interfaceCalc.render();
        });

        spaceKey.addEventListener("click", () => {
            interfaceCalc.add(" ");
            interfaceCalc.render();
        });

        dotKey.addEventListener("click", () => {
            if (interfaceCalc.currentCalculation.includes(".")) return;
            interfaceCalc.add(dotKey.innerText);
            interfaceCalc.render();
        });

        exitKey.addEventListener("click", () => {
            interfaceCalc.runCalculator("S");
            interfaceCalc.previousCalculation = "";
            interfaceCalc.render();
        });

        helpKey.addEventListener("click", () => {
            interfaceCalc.runCalculator("A");
            interfaceCalc.previousCalculation = "";
            interfaceCalc.render();
        });

            // operandKeys.forEach(key => {
            //     key.addEventListener("click", () => mainDisplay.firstElementChild.innerText += key.innerText);
            // });

            // operatorKeys.forEach(key => {
            //     key.addEventListener("click", () => mainDisplay.firstElementChild.innerText += key.innerText);
            // });

            // dotKey.addEventListener("click", () => {
            //     if (mainDisplay.firstElementChild.innerText.includes(".")) return
            //     mainDisplay.firstElementChild.innerText += dotKey.innerText
            // })
    </script>
</body>

</html>
<!-- // Esquecer memória pois não foi pensada tendo em conta a componente gráfica.
// Em compensação, permitir teclas de parênteses
// O visor deve mostrar todos os caracteres que vamos escrevendo
// Criar um backspace para apagar últimos caracteres
// Todos os operadores devem aparecer no visor
// Acrescentar texto de referência sobre a operacionalidade em NPR
// parênteses necessários somente para cálculo de expressões complexas: + 1 2 (funcionaria)
// modo gráfico permite excepções para cálculo de linha anterior. 
// botão de igual = executa a expressão, depois mostra resultado
// ao mostrar resultado da expresão, coloca expressão calculada em cima e em tamanho pequeno
// colocar parênteses automáticos nos operadores unários (?)
// ter botão clear para limpar tudo
// adicionar tecla de espaço -->
<!-- // const run = () => {
    //     const input = prompt("Insira o comando: ");
    //     const output = calculator.runCommand(input);
    //     alert(output);

    //     if (output !== "Aplicação terminada. Até à próxima.") {
    //         run();
    //     } else {
    //         stop();
    //     }
    // };

    // alert("Bem-Vindo à Calculadora Recursiva.\nPara lista de comandos prima 'A'");
    // run(); -->